$(document).ready(function(){function e(){function e(e){var o=e.coords.latitude,t=e.coords.longitude;i=o,r=t,n()}function o(){alert("Can't find your location. Please adjust settings")}return navigator.geolocation?void navigator.geolocation.getCurrentPosition(e,o):void alert("Geolocation is not supported by your browser")}function o(){for(var e=new google.maps.LatLngBounds,o=0;o<u.length;o++)e.extend(u[o].getPosition());s.fitBounds(e)}function n(){var e=document.getElementById("map-canvas"),n=new google.maps.LatLng(i,r),a={center:n,zoom:13,mapTypeId:google.maps.MapTypeId.ROADMAP,panControl:!0,panControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP},zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.RIGHT_TOP}};s=new google.maps.Map(e,a),google.maps.event.addListener(s,"click",function(e){var o=e.latLng.lat(),n=e.latLng.lng();t(o,n,function(e){$('<div class="onePoint"><input class="form-control inputSize in_name'+d+'" value="'+g(e)+'"+></input><a href="#"><img class="xButton" src="css/painted-x.png"></a><textarea placeholder="Enter location description here" class="form-control inputSize2 in_text'+d+'"></textarea><br><input type=hidden class="pointAddr'+d+'"value="'+e+'"+></input><input type=hidden class="hiddenLat pointLat'+d+'"value='+o+'></input><input type=hidden class="hiddenLng pointLng'+d++ +'"value='+n+"></input></div>").hide().appendTo(".div_container").fadeIn()})});var l=document.getElementById("pac-input"),p=new google.maps.places.SearchBox(l);google.maps.event.addListener(p,"places_changed",function(){var e=p.getPlaces();if(console.log("PLACES: "+l.value),0!=e.length)for(var n,t=0;n=e[t];t++){var a=new google.maps.Marker({map:s,position:n.geometry.location});c.setContent(l.value),c.open(s,a),u.push(a),o(),$('<div class="onePoint"><input class="form-control inputSize in_name'+d+'" value="'+g(l.value)+'"+></input><a href="#"><img class="xButton" src="css/painted-x.png"></a><textarea placeholder="Enter location description here" class="inputSize2 form-control in_text'+d+'"></textarea><br><input type=hidden class="pointAddr'+d+'"value="'+l.value+'"+></input><input type=hidden class="hiddenLat pointLat'+d+'"value='+n.geometry.location.lat()+'></input><input type=hidden class="hiddenLng pointLng'+d++ +'"value='+n.geometry.location.lng()+"></input></div>").hide().appendTo(".div_container").fadeIn(),$("#pac-input").val(""),l.value=""}}),google.maps.event.addListener(s,"bounds_changed",function(){var e=s.getBounds();p.setBounds(e)})}function t(e,n,t){var a=e,i=n,r=new google.maps.LatLng(a,i);l.geocode({latLng:r},function(e,n){n==google.maps.GeocoderStatus.OK?e[1]?(marker=new google.maps.Marker({position:r,map:s}),c.setContent(e[1].formatted_address),c.open(s,marker),u.push(marker),o(),t(e[1].formatted_address)):alert("No results found"):alert("Geocoder failed due to: "+n)})}function a(){var e=document.getElementsByTagName("form")[0];return e.checkValidity()?!0:!1}var i,r,s,l=new google.maps.Geocoder,c=new google.maps.InfoWindow({maxWidth:100}),d=0,p={mapName:null,locations:[]},u=[],g=function(e){console.log(e);var o=e.split(",");return o[0]};google.maps.event.addDomListener(window,"load",e),$(".pushToServer").click(function(){if(a()){for(var e=$(".onePoint").length,o=0;e>o;o++){var n={};n.name=$(".in_name"+o).val(),n.lat=$(".pointLat"+o).val(),n.lng=$(".pointLng"+o).val(),n.address=$(".pointAddr"+o).val(),n.desc=$(".in_text"+o).val(),p.locations.push(n)}p.mapName=$("#mapTit").val(),console.log(p),console.log(u),$.ajax({type:"POST",url:"/createMaps",data:p,success:function(e){swal({title:"Your map has been created!",text:"You can now view your map",type:"success",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, show me!",cancelButtonText:"No, create a new map",closeOnConfirm:!1,closeOnCancel:!1},function(o){window.location=o?"/maps/"+e:"/createMaps"})},error:function(){swal("Whoops!","Please submit again","error")}})}else swal("Please Enter a Map Title","Whoops","warning")}),$(document).ready(function(){$(".resetMap").click(function(){$(".onePoint").fadeOut()}),$(document).on("click","img.xButton",function(){$(this).closest(".onePoint").fadeOut()})})});var narrative=document.getElementById("narrative"),sections=narrative.getElementsByTagName("section"),currentId="",setId=function(e){if(e!==currentId){placesLayer.eachLayer(function(o){o.feature.properties.id===e?(map.setView(o.getLatLng(),o.feature.properties.zoom||16),o.setIcon(L.mapbox.marker.icon({"marker-color":"#FF2249","marker-size":"large","marker-symbol":"marker-stroked"}))):o.setIcon(L.mapbox.marker.icon({"marker-color":"#404040","marker-size":"large","marker-symbol":"marker-stroked"}))});for(var o=0;o<sections.length;o++)sections[o].className=sections[o].id===e?"active":"";currentId=e}},onScroll=_.debounce(function(e){e.preventDefault();for(var o=narrative.offsetHeight,n=currentId,t=sections.length-1;t>=0;t--){var a=sections[t].getBoundingClientRect();a.top>=0&&a.top<=o&&(n=sections[t].id)}setId(n)},50);setId("cover"),narrative.onscroll=onScroll;